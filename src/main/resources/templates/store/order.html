<!DOCTYPE html>
<html lagn="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8" />
    <title>index</title>
    <meta name="viewport" content="width=device-width, maximum-scale=1.0, minimum-scale=1, user-scalable=yes,initial-scale=1.0" />
    <link rel="stylesheet" th:href="@{/css/store/myStore.css}">
    <!-- content script -->
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/layout/header.css}">
    </th:block>
    <!-- content script -->
    <th:block layout:fragment="script">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script th:src="@{/js/addr.js}"></script>
    </th:block>
</head>
<th:block th:replace="fragments/header :: headerFragment"></th:block>
<body>
    <div class="container">
        <div class="manage">
            <div class="top-menu">
                <button><a href="/store/order">주문접수</a></button>
                <button><a href="/store/manage">매장관리</a></button>
            </div>
            <div style="display: flex;">
                <div class="side-menu">
                    <button class="active"><a href="/store/order">처리중</a></button>
                    <button><a href="/store/completion" style="color: #fff;">완료</a></button>
                </div>
                <div class="menu-list">
                    <div style="border-bottom: 1px solid #ddd;text-align: center;font-weight: 700;">
                        신규
                    </div>
                    <div th:if="${order == null}" style="text-align: center" id="default">
                        <h4>주문 정보가 없습니다.</h4>
                    </div>
                    <div th:if="${order != null}" class="select-menu" th:each="order:${order}" th:id="${order.orderNo}+'Class'">
                        <div th:orderNo="${order.orderNo}"
                             th:onclick="orderNo(this.getAttribute('orderNo'))" style="cursor: pointer;">
                            <strong>배달 <strong th:text="${order.orderNo}"></strong></strong><br>
                            <div th:each="menu:${menu}">
                                <div th:id="${order.orderNo}" th:if="${menu.orderNo}==${order.orderNo}">
                                    <span id="menuCount"></span>
                                </div>
                            </div>
                            <div class="new" id="new">신규</div>
                        </div>
                    </div>
                    <div style="border-bottom: 1px solid #ddd;text-align: center;font-weight: 700;">
                        진행
                    </div>
                    <div th:if="${order == null}" style="text-align: center" id="default">
                        <h4>주문 정보가 없습니다.</h4>
                    </div>
                    <div class="select-menu">
                        <strong>배달 번호</strong><br>
                        <span>메뉴 1개</span>
                        <div class="ing">60분</div>
                    </div>
                </div>
                <div style="width: 70%;background-color: #f5f5f5;">
                    <div id="default" style="text-align: center;margin-top: 100px">
                        <h1>주문내역을 선택해주세요.</h1>
                    </div>
                    <div th:if="${order != null}" id="showMenu" style="display: none">
                        <div style="padding: 20px;display: flex;justify-content: space-between;align-items: center;">
                            <div style="width: 60%;">
                                <div style="font-size: 25px;font-weight: 700;">배달 <strong id="orderNum"></strong></div>
                                <div style="font-size: 18px;">
                                    <strong>메뉴 <strong id="count"></strong>개</strong>
                                    <strong> · 총 <strong id="money"></strong>원</strong>
                                    <strong id="pay"> (결제완료)</strong>
                                </div>
                            </div>
                            <div style="align-self: center;width: 40%;margin-top: 20px">
                                <button class="submit" id="">거부</button>
                                <div id="inpList">
                                    <input type="button" onclick="fnCalCount('m',this);" value="-"><input name="cnt" value="60">분<input type="button" onclick="fnCalCount('p',this);" value="+">
                                </div>
                                <button class="submit" id="">접수</button>
                            </div>
                        </div>
                        <div style="display: flex;padding: 20px;justify-content: space-around;height: 488px;">
                            <div style="width: 55%;display: flex;flex-direction: column;justify-content: space-between;">
                                <div style="border: 1px solid #ddd;height: 48%;padding: 20px;background-color: white;margin-bottom: 12px;">
                                    <div style="margin-bottom: 10px;">요청사항</div>
                                    <table width="100%">
                                        <tr style="height: 70px">
                                            <td>가게</td>
                                            <td><input id="forCeo" type="text" style="border: none;background-color: white" disabled></td>
                                        </tr>
                                        <tr style="height: 70px">
                                            <td>배달</td>
                                            <td><input id="forRider" type="text" style="border: none;background-color: white" disabled></td>
                                        </tr>
                                    </table>
                                </div>
                                <div style="border: 1px solid #ddd;height: 48%;padding: 20px;background-color: white;">
                                    <div style="margin-bottom: 10px;">주문내역</div>
                                    <table id="menu"  class="order-list" width="100%"></table>
                                </div>
                            </div>
                            <div style="width: 40%;border: 1px solid #ddd;background-color: white;padding:20px;margin-left: 12px;">
                                <div style="margin-bottom: 40px">
                                    <h4 style="margin-bottom: 5px">배달지</h4>
                                    <div id="address"></div>
                                </div>
                                <div style="margin-bottom: 40px">
                                    <h4 style="margin-bottom: 5px">고객연락처</h4>
                                    <div id="phone"></div>
                                </div>
                                <div>
                                    <table id="rightMenu">
                                        <tr>
                                            <td><strong>배달시간</strong></td>
                                            <td id="delTime"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>주문번호</strong></td>
                                            <td id="orderNum1"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>주문시간</strong></td>
                                            <td id="orderTime"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>가게정보</strong></td>
                                            <td id="storeName"></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script th:src="@{/js/store/order.js}"></script>
<script th:inline="javascript">
    $(document).ready(function () {
       document.getElementById("default").style.display = "block";
    });

    function fnCalCount(type, e) {
        var pinp = $(e).siblings("input")[1];
        var minp = $(e).siblings("input")[0];
        // plus눌렀을때 count
        var pCount = parseInt(pinp.value);
        // minus눌렀을때 count
        var mCount = parseInt(minp.value);
        if(type=='p'){
            pinp.value = pCount + 1
        }else if(mCount <= 20){
            minp.value = 20
        }
        else{
            minp.value = mCount - 1
        }
    }

    function orderNo(orderNo) {
        document.getElementById(orderNo+"Class").classList.add('view');
        document.getElementById("default").style.display = "none";
        document.getElementById("showMenu").style.display = "block";
        var json = {
            orderNo : orderNo
        }
        $.ajax({
            url:"/orderNo",
            type:"POST",
            data:JSON.stringify(json),
            dataType:'json',
            contentType: "application/json; charset=UTF-8",
            success : function (data) {
                var menuCount = data[0].length;
                var div = document.getElementById("menu")
                div.innerHTML = "";
                for(var i = 0; i<menuCount;i++){
                    div.innerHTML +=
                        `
                           <tr>
                               <td>`+data[0][i].foodName +`</td>
                               <td>`+data[0][i].num +`개</td>
                               <td>`+data[0][i].menuPrice +`원</td>
                           </tr>

                        `;
                }
                div.innerHTML += `
                    <tr>
                        <td>배달팁</td>
                        <td></td>
                        <td>`+data[1].tip+`원</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>`+menuCount+`개</td>
                        <td>`+data[1].totalMoney+`원</td>
                    </tr>
                `;

                document.getElementById("orderNum").innerText = data[1].orderNo;
                document.getElementById("orderNum1").innerText = data[1].orderNo;
                document.getElementById("count").innerText = menuCount;
                document.getElementById("forCeo").value = data[1].forCeo;
                document.getElementById("forRider").value = data[1].forRider;
                document.getElementById("address").innerText = data[1].location;
                document.getElementById("phone").innerText = data[1].phone;
                document.getElementById("orderTime").innerText = data[1].orderDate;
                document.getElementById("storeName").innerText = data[1].storeName;
                document.getElementById("money").innerText = data[1].totalMoney;
            }
        })
    }
</script>
</html>